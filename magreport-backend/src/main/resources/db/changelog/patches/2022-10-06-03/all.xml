<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
        https://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.11.xsd">

    <changeSet id="V_REPORT_FILTER_FIELD_LNK" author="artemenko_pa">
        <createView schemaName="REPOSITORY" viewName="V_REPORT_FILTER_FIELD_LNK"
                    fullDefinition="false" replaceIfExists="true">
            SELECT
                FRG.REPORT_ID,
                RF.DATASET_FIELD_ID REPORT_DATASET_FIELD_ID,
                RDF.NAME AS REPORT_DATASET_FIELD_NAME,
                FIFC.DATASET_FIELD_ID FILTER_DATASET_FIELD_ID,
                FDF.NAME AS FILTER_DATASET_FIELD_NAME
            FROM REPOSITORY.FILTER_REPORT_GROUP FRG
                     INNER JOIN REPOSITORY.REPORT R ON R.REPORT_ID = FRG.REPORT_ID
                     INNER JOIN REPOSITORY.FILTER_REPORT FR ON FR.FILTER_REPORT_GROUP_ID = FRG.FILTER_REPORT_GROUP_ID
                     INNER JOIN REPOSITORY.FILTER_REPORT_FIELD FRF ON FRF.FILTER_REPORT_ID = FR.FILTER_REPORT_ID
                     INNER JOIN REPOSITORY.REPORT_FIELD RF ON RF.REPORT_FIELD_ID = FRF.REPORT_FIELD_ID
                     INNER JOIN REPOSITORY.DATASET_FIELD RDF ON RDF.DATASET_FIELD_ID = RF.DATASET_FIELD_ID
                     INNER JOIN REPOSITORY.FILTER_INSTANCE FI ON FI.FILTER_INSTANCE_ID = FR.FILTER_INSTANCE_ID
                     INNER JOIN REPOSITORY.FILTER_INSTANCE_FIELD FIF ON FIF.FILTER_INSTANCE_ID = FR.FILTER_INSTANCE_ID  AND FIF.FILTER_INSTANCE_FIELD_ID = FRF.FILTER_INSTANCE_FIELD_ID
                     INNER JOIN REPOSITORY.FILTER_TEMPLATE_FIELD FTF ON FTF.FILTER_TEMPLATE_FIELD_ID = FIF.FILTER_TEMPLATE_FIELD_ID AND FTF.FILTER_FIELD_TYPE_ID = 0
                     INNER JOIN REPOSITORY.FILTER_INSTANCE_FIELD FIFC ON FIFC.FILTER_INSTANCE_ID = FIF.FILTER_INSTANCE_ID AND FIFC.LEVEL = FIF.LEVEL
                     INNER JOIN REPOSITORY.DATASET_FIELD FDF ON FDF.DATASET_FIELD_ID = FIFC.DATASET_FIELD_ID
                     INNER JOIN REPOSITORY.FILTER_TEMPLATE_FIELD FTFC ON FTFC.FILTER_TEMPLATE_FIELD_ID = FIFC.FILTER_TEMPLATE_FIELD_ID AND FTFC.FILTER_FIELD_TYPE_ID = 1;
        </createView>
    </changeSet>

</databaseChangeLog>
