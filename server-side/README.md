# Сборка rpm-пакета и установка обновления

_Все действия необходимо выполнять на linux-машине в домашнем каталоге пользователя_

## Подготовка домашнего каталога

1. Скопировать содержимое каталога

    server-side
    
в домашний каталог пользователя.

2. Выполнить

    chmod +x *.sh
    chmod +x ./rpmbuild/rpmbuild-magreport2.sh
    
3. Выполнить

    ./make-dirs.sh
    
## Сборка пакета

1. Отредактировать скрипт build-magreport2-rpm.sh: в переменной version записать номер версии сборки. Если сборка предназначена для тестовой платформы, номер версии должен заканчиваться символом "t".

2. Выполнить

    ./build-magreport2-rpm.sh
    
Если в процессе сборки не было сообщений об ошибках и вконце было выведено "exit 0", то сборка прошла успешно. Собранный rpm-пакет будет находиться в каталоге

    ~/rpmbuild/RPMS/x86_64

И будет иметь в названии указанный номер версии.

## Установка пакета и перезапуск сервиса

Все действия этого пункта выполняются одинаково на тестовом и промышленнос сервере.

1. Останов, запуск и перезапуск сервиса выполняется командами

    sudo service magreport2 stop

    sudo service magreport2 start

    sudo service magreport2 restart
    
2. Формирование бэкапа БД выполняется скриптом

    ./make-db-backup.sh
    
3. Установка новой сборки magreport2 вместе с формирование бэкапа БД и рестартом сервиса выполняется скриптом

    ./install-release.sh <rpm-файл>
    
с указанием файла пакета обновления.
    
Скрипт выполняет последовательно следующие шаги:
- остановка сервиса
- формирование бэкапа БД
- установка новой версии пакета
- запуск сервиса

Если какой-то из шагов выполнен неуспешно, выводится соответствующее информационное сообщение и дальнейшее выполнение скрипта прекращается.
